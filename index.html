<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vota√ß√£o ‚Äî Mostra sobre Abelhas</title>
  <style>
    /* Estilos omitidos para brevidade */
  </style>
</head>
<body>
  <div class="wrap">
    <header class="card" role="banner">
      <h1>Voc√™ que assistiu √† nossa apresenta√ß√£o, conhece nossa ideia.</h1>
      <p class="lead">Se n√£o conhece: n√≥s participamos da mostra cient√≠fica das escolas estaduais do Rio Grande do Sul, e nosso trabalho foi sobre Abelhas e Sua Import√¢ncia. Decidimos propor uma ODS (Objetivo de Desenvolvimento Social) a respeito delas, e contamos com o apoio de todos na nossa jornada!</p>
    </header>

    <main class="card" role="main" aria-live="polite">
      <div class="options" role="radiogroup" aria-label="Op√ß√µes de vota√ß√£o">
        <button id="btn-support" class="vote support" aria-checked="false" role="radio">
          <span class="thumb">üëç</span><span>Apoio!</span>
        </button>
        <button id="btn-against" class="vote against" aria-checked="false" role="radio">
          <span class="thumb">üëé</span><span>N√£o apoio.</span>
        </button>
      </div>

      <div class="results" id="results">
        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;">
          <div style="flex:1; margin-right:12px">
            <div class="small">Apoio: <strong id="pct-support">0%</strong></div>
            <div class="bar"><div id="bar-support" class="fill support"></div></div>
          </div>
          <div style="width:110px;text-align:right">
            <div class="small">N√£o apoio: <strong id="pct-against">0%</strong></div>
            <div class="bar"><div id="bar-against" class="fill against"></div></div>
          </div>
        </div>
        <div class="counts">
          <span id="count-support">0 votos</span>
          <span id="count-against">0 votos</span>
        </div>
      </div>

      <div class="meta">
        <div class="center small">Status: <span id="status">Voc√™ ainda n√£o votou.</span></div>
      </div>
    </main>
  </div>

  <script>
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbxoMY88uLaswSDK5XOUE5YA9LBYTOQ0LbBOtsACkg09rua2OpZGxgWsyWRr9ETsF_n3/exec';

    const btnSupport = document.getElementById('btn-support');
    const btnAgainst = document.getElementById('btn-against');
    const pctSupport = document.getElementById('pct-support');
    const pctAgainst = document.getElementById('pct-against');
    const barSupport = document.getElementById('bar-support');
    const barAgainst = document.getElementById('bar-against');
    const countSupport = document.getElementById('count-support');
    const countAgainst = document.getElementById('count-against');
    const status = document.getElementById('status');

    let voted = localStorage.getItem('voted') === 'true';

    function render(support, against){
      const total = support + against;
      const pSup = total > 0 ? Math.round((support / total) * 100) : 0;
      const pAga = total > 0 ? 100 - pSup : 0;
      pctSupport.textContent = pSup + '%';
      pctAgainst.textContent = pAga + '%';
      barSupport.style.width = pSup + '%';
      barAgainst.style.width = pAga + '%';
      countSupport.textContent = support + ' votos';
      countAgainst.textContent = against + ' votos';
    }

    async function fetchVotes(){
      try{
        const res = await fetch(SHEET_URL);
        const data = await res.json();
        render(data.apoio || 0, data.naoApoio || 0);
      } catch(e){
        console.error('Erro ao buscar votos', e);
      }
    }

    async function vote(type){
      if(voted) return;
      voted = true;
      localStorage.setItem('voted', true);
      localStorage.setItem('votedFor', type);
      status.textContent = type === 'Apoio' ? 'Voc√™ votou em Apoio!' : 'Voc√™ votou em N√£o Apoio.';

      try{
        await fetch(SHEET_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tipo: type })
        });
        fetchVotes();
      } catch(e){
        console.error('Erro ao enviar voto', e);
      }
    }

    btnSupport.addEventListener('click', () => vote('Apoio'));
    btnAgainst.addEventListener('click', () => vote('NaoApoio'));

    // Atualizar votos a cada 5 segundos
    fetchVotes();
    setInterval(fetchVotes, 5000);
  </script>
</body>
</html>
